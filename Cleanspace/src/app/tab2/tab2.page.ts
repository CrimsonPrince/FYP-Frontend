import { Component } from '@angular/core';
import * as L from 'leaflet';

import 'mapbox-gl';
import 'mapbox-gl-leaflet';
import 'leaflet.markercluster'

@Component({
  selector: 'app-tab2',
  templateUrl: 'tab2.page.html',
  styleUrls: ['tab2.page.scss']
})
export class Tab2Page {


  constructor() {}

    // The below function is added
    ionViewDidEnter(){
      this.loadMap();
    }
   // The below function is added
    loadMap() {
      let addressPoints = [
        {"id": "AD-1", "country": "AD", "city": "Escaldes-Engordany", "cities": ["Escaldes-Engordany"], "location": "AD0942A", "locations": ["AD0942A"], "sourceName": "EEA Andorra", "sourceNames": ["EEA Andorra"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 1.53914, "latitude": 42.50969}, "firstUpdated": "2017-09-13T21:00:00.000Z", "lastUpdated": "2020-07-22T12:00:00.000Z", "parameters": ["co", "no2", "o3", "pm10", "so2"], "countsByMeasurement": [{"parameter": "co", "count": 20174}, {"parameter": "no2", "count": 19881}, {"parameter": "o3", "count": 20231}, {"parameter": "pm10", "count": 20433}, {"parameter": "so2", "count": 19934}], "count": 100653}, {"id": "AD-2", "country": "AD", "city": "Escaldes-Engordany", "cities": ["Escaldes-Engordany"], "location": "AD0944A", "locations": ["AD0944A"], "sourceName": "EEA Andorra", "sourceNames": ["EEA Andorra"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 1.56525, "latitude": 42.51694}, "firstUpdated": "2017-09-13T21:00:00.000Z", "lastUpdated": "2020-07-22T12:00:00.000Z", "parameters": ["o3"], "countsByMeasurement": [{"parameter": "o3", "count": 20027}], "count": 20027}, {"id": "AD-3", "country": "AD", "city": "unused", "cities": ["unused"], "location": "AD0945A", "locations": ["AD0945A"], "sourceName": "EEA Andorra", "sourceNames": ["EEA Andorra"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 1.71699, "latitude": 42.53488}, "firstUpdated": "2017-09-14T00:00:00.000Z", "lastUpdated": "2020-07-22T12:00:00.000Z", "parameters": ["o3"], "countsByMeasurement": [{"parameter": "o3", "count": 9964}], "count": 9964}, {"id": "AE-1", "country": "AE", "city": "Abu Dhabi", "cities": ["Abu Dhabi"], "location": "US Diplomatic Post: Abu Dhabi", "locations": ["US Diplomatic Post: Abu Dhabi"], "sourceName": "StateAir_AbuDhabi", "sourceNames": ["StateAir_AbuDhabi"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 54.43375, "latitude": 24.4244}, "firstUpdated": "2017-12-26T22:00:00.000Z", "lastUpdated": "2020-07-22T12:00:00.000Z", "parameters": ["o3", "pm25"], "countsByMeasurement": [{"parameter": "o3", "count": 17594}, {"parameter": "pm25", "count": 21344}], "count": 38938}, {"id": "AE-2", "country": "AE", "city": "Dubai", "cities": ["Dubai", "N/A"], "location": "US Diplomatic Post: Dubai", "locations": ["US Diplomatic Post: Dubai", "Dubai"], "sourceName": "StateAir_Dubai", "sourceNames": ["StateAir_Dubai", "AirNow"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 55.30917, "latitude": 25.25848}, "firstUpdated": "2018-07-27T15:00:00.000Z", "lastUpdated": "2020-07-22T12:00:00.000Z", "parameters": ["o3", "pm25"], "countsByMeasurement": [{"parameter": "o3", "count": 20757}, {"parameter": "pm25", "count": 22716}], "count": 43473}, {"id": "AE-3", "country": "AE", "city": "N/A", "cities": ["N/A"], "location": "Abu Dhabi", "locations": ["Abu Dhabi"], "sourceName": "AirNow", "sourceNames": ["AirNow"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 54.43387, "latitude": 24.42431}, "firstUpdated": "2019-10-28T18:00:00.000Z", "lastUpdated": "2020-07-21T19:00:00.000Z", "parameters": ["o3", "pm25"], "countsByMeasurement": [{"parameter": "o3", "count": 4549}, {"parameter": "pm25", "count": 5246}], "count": 9795}, {"id": "AF-1", "country": "AF", "city": "Kabul", "cities": ["Kabul"], "location": "US Diplomatic Post: Kabul", "locations": ["US Diplomatic Post: Kabul"], "sourceName": "StateAir_Kabul", "sourceNames": ["StateAir_Kabul"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 69.19051, "latitude": 34.53581}, "firstUpdated": "2019-10-20T22:30:00.000Z", "lastUpdated": "2020-07-22T12:30:00.000Z", "parameters": ["pm25"], "countsByMeasurement": [{"parameter": "pm25", "count": 7159}], "count": 7159}, {"id": "AF-2", "country": "AF", "city": "N/A", "cities": ["N/A"], "location": "Kabul", "locations": ["Kabul"], "sourceName": "AirNow", "sourceNames": ["AirNow"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 69.2046, "latitude": 34.55438}, "firstUpdated": "2019-10-28T18:30:00.000Z", "lastUpdated": "2020-07-22T11:30:00.000Z", "parameters": ["pm25"], "countsByMeasurement": [{"parameter": "pm25", "count": 5015}], "count": 5015}, {"id": "AG-1", "country": "AG", "city": "N/A", "cities": ["N/A"], "location": "Algiers", "locations": ["Algiers"], "sourceName": "AirNow", "sourceNames": ["AirNow"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 3.03911, "latitude": 36.7558}, "firstUpdated": "2020-03-17T17:00:00.000Z", "lastUpdated": "2020-03-17T17:00:00.000Z", "parameters": ["pm25"], "countsByMeasurement": [{"parameter": "pm25", "count": 1}], "count": 1}, {"id": "AR-2", "country": "AR", "city": "Buenos Aires", "cities": ["Buenos Aires"], "location": "CENTENARIO", "locations": ["CENTENARIO"], "sourceName": "Buenos Aires", "sourceNames": ["Buenos Aires"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": -58.43194, "latitude": -34.60638}, "firstUpdated": "2017-08-10T16:00:00.000Z", "lastUpdated": "2017-10-19T03:00:00.000Z", "parameters": ["co", "no2", "pm10"], "countsByMeasurement": [{"parameter": "co", "count": 1392}, {"parameter": "no2", "count": 1392}, {"parameter": "pm10", "count": 1392}], "count": 4176}, {"id": "AR-4", "country": "AR", "city": "Buenos Aires", "cities": ["Buenos Aires"], "location": "CORDOBA", "locations": ["CORDOBA"], "sourceName": "Buenos Aires", "sourceNames": ["Buenos Aires"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": -58.39165, "latitude": -34.60442}, "firstUpdated": "2017-08-10T16:00:00.000Z", "lastUpdated": "2017-10-19T03:00:00.000Z", "parameters": ["co", "no2", "pm10"], "countsByMeasurement": [{"parameter": "co", "count": 1392}, {"parameter": "no2", "count": 1392}, {"parameter": "pm10", "count": 1392}], "count": 4176}, {"id": "AR-3", "country": "AR", "city": "Buenos Aires", "cities": ["Buenos Aires"], "location": "LA BOCA", "locations": ["LA BOCA"], "sourceName": "Buenos Aires", "sourceNames": ["Buenos Aires"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": -58.36555, "latitude": -34.62527}, "firstUpdated": "2017-08-10T16:00:00.000Z", "lastUpdated": "2017-10-19T03:00:00.000Z", "parameters": ["co", "no2", "pm10"], "countsByMeasurement": [{"parameter": "co", "count": 1392}, {"parameter": "no2", "count": 1392}, {"parameter": "pm10", "count": 1392}], "count": 4176}, {"id": "AR-1", "country": "AR", "city": "Buenos Aires", "cities": ["Buenos Aires"], "location": "SPARTAN - CITEDEF", "locations": ["SPARTAN - CITEDEF"], "sourceName": "Spartan", "sourceNames": ["Spartan"], "sourceType": "research", "sourceTypes": ["research"], "coordinates": {"longitude": -58.506, "latitude": -34.56}, "firstUpdated": "2014-10-02T12:00:00.000Z", "lastUpdated": "2015-04-15T00:00:00.000Z", "parameters": ["pm25"], "countsByMeasurement": [{"parameter": "pm25", "count": 2448}], "count": 2448}, {"id": "AT-204", "country": "AT", "city": "Amt der K\ufffdrntner Landesregierung", "cities": ["Amt der K\ufffdrntner Landesregierung"], "location": "Klagenfurt A2 Nordumfahrung ", "locations": ["Klagenfurt A2 Nordumfahrung "], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 14.26889, "latitude": 46.65278}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-02-24T10:00:00.000Z", "parameters": ["no2"], "countsByMeasurement": [{"parameter": "no2", "count": 148}], "count": 148}, {"id": "AT-349", "country": "AT", "city": "Amt der K\ufffdrntner Landesregierung", "cities": ["Amt der K\ufffdrntner Landesregierung"], "location": "Klagenfurt A2 Nordumfahrung 2", "locations": ["Klagenfurt A2 Nordumfahrung 2"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 14.26611, "latitude": 46.65306}, "firstUpdated": "2017-06-30T00:00:00.000Z", "lastUpdated": "2017-06-30T12:00:00.000Z", "parameters": ["no2"], "countsByMeasurement": [{"parameter": "no2", "count": 13}], "count": 13}, {"id": "AT-286", "country": "AT", "city": "Amt der K\ufffdrntner Landesregierung", "cities": ["Amt der K\ufffdrntner Landesregierung"], "location": "St. Andr\ufffd i. L. Volksschule", "locations": ["St. Andr\ufffd i. L. Volksschule"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 14.82222, "latitude": 46.76389}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-07-20T19:00:00.000Z", "parameters": ["pm10"], "countsByMeasurement": [{"parameter": "pm10", "count": 2959}], "count": 2959}, {"id": "AT-306", "country": "AT", "city": "Amt der K\ufffdrntner Landesregierung", "cities": ["Amt der K\ufffdrntner Landesregierung"], "location": "St. Veit a. d. Glan Hauptbahnhof", "locations": ["St. Veit a. d. Glan Hauptbahnhof"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 14.36583, "latitude": 46.77111}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-05-11T19:00:00.000Z", "parameters": ["pm10"], "countsByMeasurement": [{"parameter": "pm10", "count": 1579}], "count": 1579}, {"id": "AT-297", "country": "AT", "city": "Amt der Nieder\ufffdsterreichischen Landesregierung", "cities": ["Amt der Nieder\ufffdsterreichischen Landesregierung"], "location": "Mannsw\ufffdrth bei Schwechat, Danubiastra\ufffde/A4", "locations": ["Mannsw\ufffdrth bei Schwechat, Danubiastra\ufffde/A4"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 16.51111, "latitude": 48.145}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-07-20T19:00:00.000Z", "parameters": ["no2", "pm10"], "countsByMeasurement": [{"parameter": "no2", "count": 2971}, {"parameter": "pm10", "count": 2965}], "count": 5936}, {"id": "AT-260", "country": "AT", "city": "Amt der Ober\ufffdsterreichischen Landesregierung", "cities": ["Amt der Ober\ufffdsterreichischen Landesregierung"], "location": "Lenzing Winterstrasse", "locations": ["Lenzing", "Lenzing Winterstrasse"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 13.60083, "latitude": 47.97194}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-07-20T19:00:00.000Z", "parameters": ["no2", "o3", "pm10", "so2"], "countsByMeasurement": [{"parameter": "no2", "count": 2971}, {"parameter": "o3", "count": 2967}, {"parameter": "pm10", "count": 823}, {"parameter": "so2", "count": 2964}], "count": 9725}, {"id": "AT-307", "country": "AT", "city": "Amt der Salzburger Landesregierung", "cities": ["Amt der Salzburger Landesregierung"], "location": "Zederhaus A10", "locations": ["Zederhaus A10"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 13.50508, "latitude": 47.15407}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-07-20T19:00:00.000Z", "parameters": ["no2", "o3", "pm10"], "countsByMeasurement": [{"parameter": "no2", "count": 2971}, {"parameter": "o3", "count": 2968}, {"parameter": "pm10", "count": 2965}], "count": 8904}, {"id": "AT-239", "country": "AT", "city": "Amt der Steierm\ufffdrkischen Landesregierung", "cities": ["Amt der Steierm\ufffdrkischen Landesregierung"], "location": "Liezen Alte Gasse 8", "locations": ["Liezen Alte Gasse 8"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 14.24361, "latitude": 47.56722}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-07-20T19:00:00.000Z", "parameters": ["no2", "o3", "pm10", "so2"], "countsByMeasurement": [{"parameter": "no2", "count": 2972}, {"parameter": "o3", "count": 2967}, {"parameter": "pm10", "count": 2965}, {"parameter": "so2", "count": 2964}], "count": 11868}, {"id": "AT-344", "country": "AT", "city": "Amt der Steierm\ufffdrkischen Landesregierung", "cities": ["Amt der Steierm\ufffdrkischen Landesregierung"], "location": "Peggau", "locations": ["Peggau"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 15.34583, "latitude": 47.20639}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-07-20T19:00:00.000Z", "parameters": ["no2", "pm10"], "countsByMeasurement": [{"parameter": "no2", "count": 2969}, {"parameter": "pm10", "count": 2965}], "count": 5934}, {"id": "AT-333", "country": "AT", "city": "Amt der Steierm\ufffdrkischen Landesregierung", "cities": ["Amt der Steierm\ufffdrkischen Landesregierung"], "location": "Weiz Birkfelder Stra\ufffde", "locations": ["Weiz Birkfelder Stra\ufffde"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 15.62833, "latitude": 47.21722}, "firstUpdated": "2017-02-18T07:00:00.000Z", "lastUpdated": "2017-07-20T19:00:00.000Z", "parameters": ["no2", "o3", "pm10"], "countsByMeasurement": [{"parameter": "no2", "count": 2972}, {"parameter": "o3", "count": 2968}, {"parameter": "pm10", "count": 2965}], "count": 8905}, {"id": "AT-16", "country": "AT", "city": "Austria", "cities": ["Austria"], "location": "Amstetten", "locations": ["Amstetten"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 14.87916, "latitude": 48.12029}, "firstUpdated": "2016-11-18T05:00:00.000Z", "lastUpdated": "2016-12-12T09:00:00.000Z", "parameters": ["no2", "o3", "pm10"], "countsByMeasurement": [{"parameter": "no2", "count": 272}, {"parameter": "o3", "count": 271}, {"parameter": "pm10", "count": 284}], "count": 827}, {"id": "AT-15", "country": "AT", "city": "Austria", "cities": ["Austria"], "location": "Annaberg - Joachimsberg", "locations": ["Annaberg - Joachimsberg"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 15.32193, "latitude": 47.85527}, "firstUpdated": "2016-11-18T05:00:00.000Z", "lastUpdated": "2016-12-12T09:00:00.000Z", "parameters": ["o3"], "countsByMeasurement": [{"parameter": "o3", "count": 268}], "count": 268}, {"id": "AT-89", "country": "AT", "city": "Austria", "cities": ["Austria"], "location": "Arnfels - Remschnigg", "locations": ["Arnfels - Remschnigg"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 15.36775, "latitude": 46.65197}, "firstUpdated": "2016-11-18T05:00:00.000Z", "lastUpdated": "2016-12-12T09:00:00.000Z", "parameters": ["o3", "so2"], "countsByMeasurement": [{"parameter": "o3", "count": 239}, {"parameter": "so2", "count": 254}], "count": 493}, {"id": "AT-145", "country": "AT", "city": "Austria", "cities": ["Austria"], "location": "Arnoldstein Gailitz Waldsiedlungsstra\u00dfe", "locations": ["Arnoldstein Gailitz Waldsiedlungsstra\u00dfe"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 13.70497, "latitude": 46.5589}, "firstUpdated": "2016-11-18T05:00:00.000Z", "lastUpdated": "2016-12-12T09:00:00.000Z", "parameters": ["o3", "pm10", "so2"], "countsByMeasurement": [{"parameter": "o3", "count": 256}, {"parameter": "pm10", "count": 271}, {"parameter": "so2", "count": 254}], "count": 781}, {"id": "AT-125", "country": "AT", "city": "Austria", "cities": ["Austria"], "location": "Bad Ischl", "locations": ["Bad Ischl"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 13.63283, "latitude": 47.71669}, "firstUpdated": "2016-11-18T05:00:00.000Z", "lastUpdated": "2016-12-12T09:00:00.000Z", "parameters": ["no2", "o3", "pm10"], "countsByMeasurement": [{"parameter": "no2", "count": 255}, {"parameter": "o3", "count": 250}, {"parameter": "pm10", "count": 269}], "count": 774}, {"id": "AT-150", "country": "AT", "city": "Austria", "cities": ["Austria"], "location": "Bad V\u00f6slau - Gainfarn", "locations": ["Bad V\u00f6slau - Gainfarn"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 16.20695, "latitude": 47.95998}, "firstUpdated": "2016-11-18T05:00:00.000Z", "lastUpdated": "2016-12-12T09:00:00.000Z", "parameters": ["no2", "o3", "pm10"], "countsByMeasurement": [{"parameter": "no2", "count": 272}, {"parameter": "o3", "count": 271}, {"parameter": "pm10", "count": 284}], "count": 827}, {"id": "AT-131", "country": "AT", "city": "Austria", "cities": ["Austria"], "location": "Biedermannsdorf M\u00fchlengasse", "locations": ["Biedermannsdorf M\u00fchlengasse"], "sourceName": "EEA Austria", "sourceNames": ["EEA Austria"], "sourceType": "government", "sourceTypes": ["government"], "coordinates": {"longitude": 16.33721, "latitude": 48.08334}, "firstUpdated": "2016-11-18T05:00:00.000Z", "lastUpdated": "2016-12-12T09:00:00.000Z", "parameters": ["no2", "pm10"], "countsByMeasurement": [{"parameter": "no2", "count": 271}, {"parameter": "pm10", "count": 284}], "count": 555}

      ]

      var token ="pk.eyJ1IjoiY3JpbXNvbnByaW5jZSIsImEiOiJjazQyejZmajAwMmN6M2tsa211bW42bm84In0.ygXb37nll4_Y7PqqQy9JFw";

      var map = L.map('map').setView([38.912753, -77.032194], 6).setMinZoom(2).setMaxZoom(25);
      var gl = L.mapboxGL({
          accessToken: token,
          style: 'mapbox://styles/mapbox/light-v10'
      }).addTo(map);


      var markers = L.markerClusterGroup({showCoverageOnHover: false});

      for (var i = 0; i < addressPoints.length; i++) {
          var a = addressPoints[i];
          var title = a.id;
          var marker = L.circleMarker(new L.LatLng(a.coordinates.latitude, a.coordinates.longitude));
          marker.bindPopup(title);
          markers.addLayer(marker);
      }

      map.addLayer(markers);
    }

}
